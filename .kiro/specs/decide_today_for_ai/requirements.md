# 要件ドキュメント

## プロジェクト概要（入力）
全体像（`.kiro/specs/overview.md`）に基づき、ユーザの「今日の条件」を自由記述で入力し、その入力内容と登録済みのお店データを生成AIに渡して最大5件を提案する機能を作成する。既存のスコアベース選定は廃止し、候補の絞り込みと理由生成は生成AIに一任する。

## 要件

### 1. 目的
- 1.1 今日の条件を自由記述で入力でき、迷いを減らす提案を得られる
- 1.2 ルールやスコアに依存せず、生成AIの判断で候補を厳選する

### 2. 機能要件
- 2.1 ユーザは「条件入力 → 提案実行 → 候補表示」を1つのフローで行える
- 2.2 条件入力はフリー入力（自由記述）とする
- 2.3 条件は必須入力とし、未入力では提案を実行できない
- 2.4 提案対象は登録済みのお店のみとする
  - 行ったことのある店
  - 行ったことはないがユーザが登録した店
- 2.5 入力内容とお店データを生成AIに渡し、最大5件に絞り込んで提案する
- 2.6 スコアベースの選定・優先度付けは行わない
- 2.7 「行った理由」を登録・編集画面の入力項目として追加し、生成AIの判断材料として保存する
- 2.8 「次も同条件なら行くか」は将来用途の補助情報とし、入力UIには含めない

### 3. 条件入力
- 3.1 入力欄は1つの自由記述入力とする
- 3.2 入力は必須とし、空欄の場合は送信できない
- 3.3 入力内容は厳密なフィルタではなく、提案の判断材料として扱う
- 3.4 入力内容は提案理由に反映される

### 4. 提案ロジック（要求レベル）
- 4.1 登録済みのお店を候補集合とする
- 4.2 条件入力の内容とお店データを生成AIに渡す
- 4.3 「行った理由」は提案の判断・理由生成の主要な入力情報として扱う
- 4.4 生成AIが候補を最大5件に絞り込み、各候補の理由文を生成する
- 4.5 生成AIにより提案が生成できない場合は、エラーメッセージと再試行手段を表示する

### 5. 提案理由の表示
- 5.1 各提案には理由を表示する
- 5.2 理由文は生成AIで生成する

### 6. 画面・操作
- 6.1 条件入力と提案結果は同一画面で確認できる
- 6.2 提案実行中はローディング表示を行う
- 6.3 提案取得に失敗した場合はエラーメッセージと再試行手段を表示する
- 6.4 提案結果が0件の場合は、条件変更の案内を表示する

### 7. データ要件（論理）
- 7.1 提案に使うお店データには以下を含む
  - 店名
  - 来店ステータス（行った / 行っていない）
  - ジャンル（任意）
  - エリア（任意）
  - 予算帯（任意）
  - 行った理由（任意）
  - 次も同条件なら行くか（任意）

### 8. 非機能要件
- 8.1 提案結果の表示は体感的に速い（待ち時間が長くならない）
- 8.2 条件入力はエラー時でも保持され、再入力を強制しない

### 9. 受け入れ基準
- 9.1 条件が未入力の場合は提案が実行できず、入力を促す表示が出る
- 9.2 提案は登録済みのお店のみから最大5件が表示される
- 9.3 生成AIが候補を絞り込み、理由が表示される
- 9.4 スコアベースの選定が行われない
- 9.5 提案取得失敗時に再試行手段が提示される
- 9.6 条件入力が提案理由に反映される

### 対象外
- 外部サービスからの新規店舗探索・提案
- アプリが最終決定を行う機能（提案まで）
- ユーザ同士の共有・推薦
