# 設計ドキュメント

## 目的
登録済みのお店一覧を素早く確認できるようにし、候補の整理に使える一覧体験を提供する。

## スコープ
### 対象
- お店一覧の取得・表示（ローディング/空状態/エラー/再試行）
- 一覧内の主要情報表示（店名、来店ステータス、食べログURL、任意情報）
- 一覧から詳細への遷移
- 登録完了後に一覧へ遷移して最新データを確認
- ページング（最大50件/ページ）

### 対象外
- 一覧の検索・絞り込み・並び替え UI
- お店情報の編集・削除
- 無限スクロール

## 全体構成
- フロントエンド（Vite + React）で一覧画面を提供
- バックエンド（Rails）で一覧 API を提供
- ルーティングは React Router を導入し、`/places` を一覧、`/places/:id` を詳細、`/register` を登録に割り当てる
- `/` は `/places` へリダイレクトする

## 画面/UX設計
### 画面構成
- `/`：`/places` へリダイレクト
- `/places`：一覧画面（新規）
- `/places/:id`：詳細画面（既存）
- `/register`：登録フォーム（既存）

### 一覧レイアウト
- 店名（詳細リンク）
- 来店ステータス（バッジ）
- 食べログURL（外部リンク）
- 補足情報（ジャンル/エリア/予算帯/メモ）
  - いずれかが登録されている場合のみ表示
  - メモは短文で省略表示（長文は詳細で確認）
- ` /register ` へ遷移する登録ボタンを一覧画面の上部に配置

### 状態表示
- ローディング中はスケルトンまたは「読み込み中…」表示
- 空状態は「まだ登録がありません」等の案内と、登録画面への導線を表示
- 取得失敗時はエラーメッセージと再試行ボタンを表示

### ページング
- 「前へ / 次へ」ボタンのシンプルな UI
- ページング状態は URL クエリ `?page=1` に反映
- `page` / `per` は 1 以上を許可し、`per` は 50 を上限にクランプ

### 登録完了後の遷移
- 登録成功時に `/places` へ遷移
- 一覧が最新の状態になるよう取得を再実行
- 必要に応じて「登録しました」の簡易メッセージを表示

### フロントの状態
- `places`: 一覧データ
- `pagination`: `page`, `per`, `totalCount`, `totalPages`
- `isLoading`: ローディング表示
- `loadError`: エラーメッセージ

## API設計
### エンドポイント
- `GET /api/places`
  - 登録済み一覧を返却

### クエリ
- `page` (任意, 1 始まり, 省略時 1)
- `per` (任意, 1〜50, 省略時 50)

### レスポンス（成功）
```json
{
  "places": [
    {
      "id": 1,
      "name": "店名",
      "tabelog_url": "https://tabelog.com/...",
      "visit_status": "not_visited",
      "genre": "和食",
      "area": "渋谷",
      "price_range": "3000-5000",
      "note": "一人でも入りやすそう",
      "created_at": "2026-01-04T00:30:00Z",
      "updated_at": "2026-01-04T00:30:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "per": 50,
    "total_count": 80,
    "total_pages": 2
  }
}
```

### レスポンス（空）
```json
{
  "places": [],
  "pagination": {
    "page": 1,
    "per": 50,
    "total_count": 0,
    "total_pages": 0
  }
}
```

### エラー
- 500 などのサーバエラー時は汎用エラーとして扱う

## バックエンド設計
- `Api::PlacesController#index` を追加
- `Place.order(created_at: :desc)` で最新順
- `page`/`per` を整数に変換し、`per` は 50 を上限にクランプ
- `offset = (page - 1) * per` で取得
- `total_count` は `Place.count` を返す

## フロントエンド設計
### API クライアント
- `fetchPlaces({ page, per })` を追加
- レスポンスは `places` と `pagination` に分解

### コンポーネント
- `PlacesListScreen`
  - 一覧取得、状態表示、ページング UI を担当
- `PlaceListItem`
  - 1件分の表示（店名リンク、ステータス、補足情報、URL）
- 既存 `PlaceResult` は詳細専用として維持

### ルーティング
- React Router を導入
- ルート構成
  - `/` → `/places` へリダイレクト
  - `/places` → 一覧
  - `/places/:id` → 詳細
  - `/register` → 登録フォーム

## データモデル設計
- 既存 `places` テーブルを利用（変更なし）

## エラー設計
- 一覧取得エラーは画面上部に文言表示
- 再試行ボタンで `fetchPlaces` を再実行

## セキュリティ/信頼性
- 既存の入力検証は `create` で実施済み
- 一覧 API は読み取りのみで追加の認証は不要（個人利用前提）

## テスト方針
### Backend（RSpec）
- `GET /api/places` の成功（複数件）
- `created_at` 降順で返ること
- `page`/`per` のページング
- 空配列の返却

### Frontend（Vitest）
- 一覧取得成功時の表示
- ローディング状態の表示
- 空状態の表示
- 取得失敗時のエラー表示と再試行
- 登録成功後に `/places` へ遷移すること

## 依存関係
- `react-router-dom` の追加
- 既存の `fetch` 実装を流用

## 未決定事項→確定内容
- 一覧表示順: `created_at` 降順
- 1ページ最大件数: 50
- 店名リンクで詳細へ遷移

## 将来拡張
- 検索/絞り込み UI
- スクロールによるページング
