# 設計レビュー（validate-design）

## 結論
- 主要な要件に対して設計は整合しており、実装へ進められる。
- ただし、要件記述の不整合と UI/エラー時の詳細が不足しているため、設計・要件の軽微な補足が必要。

## 要件→設計の対応
- Req 1（目的）: 条件入力→提案→理由表示の流れと最大5件提示で対応済み。
- Req 2（機能）: 登録済みのみを対象、同一画面フロー、最大5件の提示で対応済み。
- Req 3（条件入力）: ジャンル/エリア/予算帯を任意入力、未入力でも実行可能な設計で対応済み。
- Req 4（提案ロジック）: ルールベースで一次候補10件、OpenAI で5件に絞り込み + 理由生成の流れで対応済み。
- Req 5（理由表示）: OpenAI 生成 + 失敗時のテンプレート理由で対応済み。
- Req 6（画面/操作）: 同一画面、ローディング、0件案内、エラー表示は設計でカバー。
- Req 7（データ要件）: `visit_reason` / `revisit_intent` の追加カラム設計で対応済み。
- Req 8（非機能）: 体感速度と入力保持の方針は設計に記載あり（詳細は要補足）。
- Req 9（受け入れ基準）: Backend/Frontend テスト方針で反映済み。

## ギャップ/懸念
- 要件ドキュメント内の不整合
  - 冒頭説明と Req 2.4 は「OpenAI は理由のみ」と記載されており、Req 4.5（絞り込み）と矛盾する。
- UI 表示の詳細不足
  - Req 2.3「5件未満時の件数表示」が設計に明記されていない。
- 再試行導線の明示
  - Req 6.3 の再試行手段が UI 設計に明記されていない。
- OpenAI 出力の安定性
  - 絞り込み結果が一次候補外になる、件数超過/不足になる等のリスクがあるため、
    返却フォーマットの厳格化（JSON スキーマやバリデーション）を明記した方が良い。

## 仕様上の判断
- ルールベースの一次候補 + OpenAI による最終選定で「毎回同じになりにくい体験」を意図する設計は要件の目的と一致。
- OpenAI 失敗時に一次候補上位5件でフォールバックする設計は安定性の観点で妥当。

## 次のアクション
- 要件ドキュメントの「OpenAI は理由のみ」の記述を修正し、絞り込みも行う前提に統一する。
- UI 仕様に「5件未満時の件数表示」と「再試行ボタン」の明記を追加する。
- OpenAI 出力の JSON 形式・検証方針を設計に追記する。
