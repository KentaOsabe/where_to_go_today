# 要件ドキュメント

## プロジェクト概要（入力）
全体像（`.kiro/specs/overview.md`）に基づき、ユーザが「今日の条件」を入力し、その条件から候補のお店を提案する機能を作成する。条件は厳密なフィルタではなく、判断を補助するための入力とし、提案は登録済みのお店から一次候補（最大10件）をルールベースで選定し、OpenAI の API で最大5件まで絞り込み + 理由文を生成する。

## 要件

### 1. 目的
- 1.1 今日の条件に合わせて候補を少数提示し、店決めの負担を減らす
- 1.2 条件は補助情報として扱い、迷わず判断できる材料を提示する

### 2. 機能要件
- 2.1 ユーザは「条件入力 → 提案実行 → 候補表示」を1つのフローで行える
- 2.2 提案対象は登録済みのお店のみとする
  - 行ったことのある店
  - 行ったことはないがユーザが登録した店
- 2.3 提案の選択肢は最大5件とし、候補が5件未満の場合はその件数を表示する
- 2.4 提案はルールベースで一次候補を作成し、OpenAI API で最大5件まで絞り込みつつ理由文を生成する

### 3. 条件入力
- 3.1 条件入力項目は以下を基本とする（すべて任意入力）
  - ジャンル
  - エリア
  - 予算帯
- 3.2 条件が未入力でも提案を実行できる
- 3.3 入力条件は厳密なフィルタではなく、提案の優先度付けに使う

### 4. 提案ロジック（要求レベル）
- 4.1 登録済みのお店を候補集合とする
- 4.2 条件との一致度や過去の評価情報を使って優先度を付ける
- 4.3 「行った理由」「次も同条件なら行くか」の情報がある場合は、優先度付けに反映する
- 4.4 ルールベースの結果から上位10件を一次候補として選定する
- 4.5 OpenAI API を用いて一次候補から最大5件に絞り込み、提案理由の文章を生成する

### 5. 提案理由の表示
- 5.1 各提案には理由を表示する
- 5.2 理由文は OpenAI API で生成する
- 5.3 OpenAI API が利用できない場合は、一次候補の上位5件をそのまま提案し、条件一致情報を用いた簡易テンプレートで理由を表示する

### 6. 画面・操作
- 6.1 条件入力と提案結果は同一画面で確認できる
- 6.2 提案実行中はローディング表示を行う
- 6.3 提案取得に失敗した場合はエラーメッセージと再試行手段を表示する
- 6.4 提案結果が0件の場合は、条件変更の案内を表示する

### 7. データ要件（論理）
- 7.1 提案に使うお店データには以下を含む
  - 店名
  - 来店ステータス（行った / 行っていない）
  - ジャンル（任意）
  - エリア（任意）
  - 予算帯（任意）
  - 行った理由（任意）
  - 次も同条件なら行くか（任意）

### 8. 非機能要件
- 8.1 提案結果の表示は体感的に速い（待ち時間が長くならない）
- 8.2 条件入力はエラー時でも保持され、再入力を強制しない

### 9. 受け入れ基準
- 9.1 条件未入力でも提案が1回以上実行できる
- 9.2 提案は登録済みのお店のみから最大5件が表示される
- 9.3 ルールベースで一次候補（最大10件）が選定される
- 9.4 OpenAI API により一次候補から最大5件に絞り込まれ、理由が生成される
- 9.5 条件に一致した情報が提案理由に反映される
- 9.6 提案取得失敗時に再試行手段が提示される
- 9.7 OpenAI API が利用不可でも理由が表示される

### 対象外
- 外部サービスからの新規店舗探索・提案
- アプリが最終決定を行う機能（提案まで）
- ユーザ同士の共有・推薦
