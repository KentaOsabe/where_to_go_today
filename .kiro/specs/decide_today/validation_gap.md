# ギャップ検証（validate-gap）

## 対象
- 仕様: `.kiro/specs/decide_today/requirements.md`
- 既存実装: backend / frontend 現状

## 結論
- 「条件入力 → ルールベース提案 → 理由表示」の機能は現状未実装で、要件に対して大きなギャップがある。
- 登録済み店舗データの取得/表示は既存実装があり、提案の候補集合として再利用可能。
- 提案理由生成に必要な OpenAI 連携・評価データ（行った理由/再訪意向）は未整備で、データ拡張と新規 API/UI が必要。

## 既存実装の確認
### バックエンド
- `Place` モデルと CRUD API は実装済み
  - エンドポイント: `GET /api/places`, `GET /api/places/:id`, `POST /api/places`, `PATCH /api/places/:id`, `DELETE /api/places/:id`
  - 保持項目: 店名 / 食べログURL / 来店ステータス / ジャンル / エリア / 予算帯 / メモ
- 提案・検索・条件入力に対応する API やサービス層は未実装
- OpenAI 連携は未実装

### フロントエンド
- 一覧/詳細/登録/編集/削除の画面と API クライアントは実装済み
- 提案条件の入力 UI、提案結果表示、提案理由表示の画面・ルーティングは未実装

## ギャップ
### 機能要件
- 条件入力画面・提案結果表示画面が未実装
- ルールベース提案ロジックが未実装
- 提案結果の最大5件制御が未実装

### データ要件
- 「行った理由」「次も同条件なら行くか」を保持するカラムが存在しない
- 条件入力（ジャンル/エリア/予算帯）を受け取って優先度付けするための API I/F が未定義

### 提案理由
- OpenAI API 連携が未実装
- OpenAI 不可時のテンプレート理由生成が未実装

### 体験/エラーハンドリング
- 提案実行中のローディング表示と失敗時の再試行導線が未実装
- 提案0件時の案内が未実装

## 既存資産の再利用候補
- 店舗データ取得: `backend/app/controllers/api/places_controller.rb` の `index`
- 店舗データ型/表示: `frontend/src/types/place.ts`, `frontend/src/components/PlaceResult.tsx`
- 入力 UI パターン: `frontend/src/components/PlaceForm.tsx` の入力/エラー表示構成

## 次のアクション
- decide_today の設計で以下を定義
  - 提案 API の I/F（条件入力・結果形式・理由文の扱い）
  - ルールベース提案ロジックと優先度付けの具体ルール
  - OpenAI 連携の責務（バックエンドで生成 or フロントから呼び出し）
  - 「行った理由」「再訪意向」データの保持方法（新規カラム or 既存 note の拡張）
  - 提案画面の遷移・UI 構成（入力、結果、エラー、0件表示）
